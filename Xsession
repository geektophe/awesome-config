#!/bin/bash

# Configures screen on identified hostname
case $(hostname) in
	thor) xrandr --output DVI-1 --right-of DVI-0 ;;
esac

# Disables speaker
xset -b

# Loads X applications configuration
/usr/bin/xrdb -load ~/.Xresources
/usr/bin/setxkbmap fr bepo

# Starts user dbus daemon
eval $( /usr/bin/dbus-launch --sh-syntax --exit-with-session )

# Starts gnome-keyring-daemon and exports its variables
eval $( /usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh)
export GNOME_KEYRING_CONTROL
export SSH_AUTH_SOCK
#export GPG_AGENT_INFO

# Starts pulseaudio
/usr/bin/start-pulseaudio-x11

# Starts other components in the background
/usr/bin/compton -b
/usr/bin/parcellite &
/usr/bin/dropboxd &
#/usr/bin/xscreensaver -no-splash &
#~/.config/awesome/bin/mcabber-watch-xscreensaver &
/usr/bin/xautolock -detectsleep -time 10 -locker "i3lock -i ~/.lockscreen.png" &

# Starts polkit server
/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &

# Starts polkit dependant services
/usr/bin/nm-applet &
#/usr/bin/blueman-applet &

# Starts urxvtd server
/usr/bin/urxvtd -q -o -f

# Starts autossh tunnel to honir
if [ -f ~/.ssh/config ]; then
	if grep -q 'Host honir-tunnel$' ~/.ssh/config; then
		/usr/bin/autossh -xaNf -M 20000 honir-tunnel
	fi
	if [ -d ~/.config/lsync ] && grep -q 'Host honir$' ~/.ssh/config; then
		/usr/bin/lsyncd ~/.config/lsync/etc/lsyncd-client.conf
		~/.config/lsync/bin/lsync &
	fi
fi

exec /usr/bin/awesome
